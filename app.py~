from fastapi import FastAPI, HTTPException
from screener import Screener
from schema.base_schema import Symbol

app = FastAPI()
screener_api = Screener()

@app.get("/")
def root():
    return {"message": "Hello World"}


@app.get("/screener")
def screener(symbol: Symbol):
    file_path = screener_api.fetch_data(symbol.symbol)
    if not file_path:
        raise HTTPException(status_code=404, detail=f"No file generated for {symbol}")
    data = screener_api.read_excel(file_path)
    if not data:
        raise HTTPException(status_code=500, detail=f"Something went wrong while fetching data for {symbol}")
    return {"symbol": symbol, "data": data}
